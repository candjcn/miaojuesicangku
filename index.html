<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寺庙仓库管理系统</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        .container {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            background-color: #2c3e50;
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .section {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #34495e;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #2980b9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #2c3e50;
            color: white;
        }

        tr:hover {
            background-color: #f5f6fa;
        }

        .warning {
            color: #e74c3c;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>寺庙仓库管理系统</h1>
        </div>

        <div class="card">
            <h2>物品管理</h2>
            <div class="form-group">
                <label for="itemName">物品名称：</label>
                <input type="text" id="itemName" required>
            </div>
            <div class="form-group">
                <label for="itemCategory">分类：</label>
                <select id="itemCategory" required>
                    <option value="">请选择分类</option>
                    <option value="佛具">佛具</option>
                    <option value="法物">法物</option>
                    <option value="日用品">日用品</option>
                </select>
            </div>
            <div class="form-group">
                <label for="itemSpec">规格：</label>
                <input type="text" id="itemSpec">
            </div>
            <div class="form-group">
                <label for="itemUnit">单位：</label>
                <input type="text" id="itemUnit" required>
            </div>
            <div class="form-group">
                <label for="itemMinStock">最低库存预警：</label>
                <input type="number" id="itemMinStock" required>
            </div>
            <button onclick="addItem()">添加物品</button>
        </div>

        <div class="card">
            <h2>库存预警</h2>
            <table id="warningTable">
                <tr>
                    <th>物品名称</th>
                    <th>当前库存</th>
                    <th>预警值</th>
                </tr>
            </table>
        </div>

        <div class="card">
            <h2>入库记录</h2>
            <div class="form-group">
                <label for="inItem">选择物品：</label>
                <select id="inItem" required>
                    <option value="">请选择物品</option>
                </select>
            </div>
            <div class="form-group">
                <label for="inQuantity">入库数量：</label>
                <input type="number" id="inQuantity" required>
            </div>
            <div class="form-group">
                <label for="inDate">入库日期：</label>
                <input type="date" id="inDate" required>
            </div>
            <button onclick="addInbound()">入库</button>
        </div>

        <div class="card">
            <h2>出库记录</h2>
            <div class="form-group">
                <label for="outItem">选择物品：</label>
                <select id="outItem" required>
                    <option value="">请选择物品</option>
                </select>
            </div>
            <div class="form-group">
                <label for="outQuantity">出库数量：</label>
                <input type="number" id="outQuantity" required>
            </div>
            <div class="form-group">
                <label for="outDate">出库日期：</label>
                <input type="date" id="outDate" required>
            </div>
            <button onclick="addOutbound()">出库</button>
        </div>

        <div class="card">
            <h2>库存统计</h2>
            <table id="inventoryTable">
                <tr>
                    <th>物品名称</th>
                    <th>当前库存</th>
                    <th>最低预警</th>
                    <th>状态</th>
                </tr>
            </table>
        </div>

        <div class="card">
            <h2>数据管理</h2>
            <button onclick="exportData()">导出数据</button>
            <button onclick="importData()">导入数据</button>
        </div>

        <script>
            // 本地存储键名定义
            const STORAGE_KEY = {
                ITEMS: 'temple_items',
                INBOUND: 'temple_inbound',
                OUTBOUND: 'temple_outbound'
            };

            // 初始化数据
            let items = JSON.parse(localStorage.getItem(STORAGE_KEY.ITEMS)) || [];
            let inboundRecords = JSON.parse(localStorage.getItem(STORAGE_KEY.INBOUND)) || [];
            let outboundRecords = JSON.parse(localStorage.getItem(STORAGE_KEY.OUTBOUND)) || [];

            // 自动生成唯一ID
            let itemIdCounter = items.length > 0 ? Math.max(...items.map(item => item.id)) + 1 : 1;
            let inboundIdCounter = inboundRecords.length > 0 ? Math.max(...inboundRecords.map(r => r.id)) + 1 : 1;
            let outboundIdCounter = outboundRecords.length > 0 ? Math.max(...outboundRecords.map(r => r.id)) + 1 : 1;

            // 更新界面
            function updateUI() {
                updateItemList();
                updateWarningTable();
                updateInventoryTable();
                updateSelectOptions();
            }

            // 添加物品
            function addItem() {
                const name = document.getElementById('itemName').value;
                const category = document.getElementById('itemCategory').value;
                const spec = document.getElementById('itemSpec').value;
                const unit = document.getElementById('itemUnit').value;
                const minStock = parseInt(document.getElementById('itemMinStock').value);

                if (!name || !unit || isNaN(minStock)) {
                    alert('请填写完整信息');
                    return;
                }

                const newItem = {
                    id: itemIdCounter++,
                    name,
                    category,
                    spec,
                    unit,
                    minStock,
                    currentStock: 0
                };

                items.push(newItem);
                localStorage.setItem(STORAGE_KEY.ITEMS, JSON.stringify(items));
                updateUI();
            }

            // 更新物品列表
            function updateItemList() {
                const list = document.getElementById('warningTable');
                list.innerHTML = '<tr><th>物品名称</th><th>当前库存</th><th>预警值</th></tr>';
                items.forEach(item => {
                    const row = list.insertRow();
                    row.insertCell().textContent = item.name;
                    row.insertCell().textContent = item.currentStock;
                    row.insertCell().textContent = item.minStock;
                    if (item.currentStock < item.minStock) {
                        row.style.backgroundColor = '#ffcccc';
                    }
                });
            }

            // 更新库存预警
            function updateWarningTable() {
                const warningTable = document.getElementById('warningTable');
                warningTable.innerHTML = '<tr><th>物品名称</th><th>当前库存</th><th>预警值</th></tr>';
                items.forEach(item => {
                    const row = warningTable.insertRow();
                    row.insertCell().textContent = item.name;
                    row.insertCell().textContent = item.currentStock;
                    row.insertCell().textContent = item.minStock;
                    if (item.currentStock < item.minStock) {
                        row.style.backgroundColor = '#ffcccc';
                    }
                });
            }

            // 更新库存统计
            function updateInventoryTable() {
                const inventoryTable = document.getElementById('inventoryTable');
                inventoryTable.innerHTML = '<tr><th>物品名称</th><th>当前库存</th><th>最低预警</th><th>状态</th></tr>';
                items.forEach(item => {
                    const row = inventoryTable.insertRow();
                    row.insertCell().textContent = item.name;
                    row.insertCell().textContent = item.currentStock;
                    row.insertCell().textContent = item.minStock;
                    row.insertCell().textContent = 
                        item.currentStock < item.minStock ? '库存不足' : '库存正常';
                });
            }

            // 更新选择框选项
            function updateSelectOptions() {
                const inSelect = document.getElementById('inItem');
                const outSelect = document.getElementById('outItem');
                inSelect.innerHTML = '<option value="">请选择物品</option>';
                outSelect.innerHTML = '<option value="">请选择物品</option>';
                items.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (${item.unit})`;
                    inSelect.appendChild(option);
                    outSelect.appendChild(option.cloneNode(true));
                });
            }

            // 添加入库记录
            function addInbound() {
                const itemId = parseInt(document.getElementById('inItem').value);
                const quantity = parseInt(document.getElementById('inQuantity').value);
                const date = document.getElementById('inDate').value;

                if (isNaN(quantity) || !date) {
                    alert('请输入有效数量和日期');
                    return;
                }

                const item = items.find(item => item.id === itemId);
                if (!item) {
                    alert('请选择有效物品');
                    return;
                }

                item.currentStock += quantity;
                localStorage.setItem(STORAGE_KEY.ITEMS, JSON.stringify(items));

                const newRecord = {
                    id: inboundIdCounter++,
                    itemId,
                    quantity,
                    date
                };

                inboundRecords.push(newRecord);
                localStorage.setItem(STORAGE_KEY.INBOUND, JSON.stringify(inboundRecords));
                updateUI();
            }

            // 添加出库记录
            function addOutbound() {
                const itemId = parseInt(document.getElementById('outItem').value);
                const quantity = parseInt(document.getElementById('outQuantity').value);
                const date = document.getElementById('outDate').value;

                if (isNaN(quantity) || !date) {
                    alert('请输入有效数量和日期');
                    return;
                }

                const item = items.find(item => item.id === itemId);
                if (!item) {
                    alert('请选择有效物品');
                    return;
                }

                if (item.currentStock < quantity) {
                    alert('库存不足');
                    return;
                }

                item.currentStock -= quantity;
                localStorage.setItem(STORAGE_KEY.ITEMS, JSON.stringify(items));

                const newRecord = {
                    id: outboundIdCounter++,
                    itemId,
                    quantity,
                    date
                };

                outboundRecords.push(newRecord);
                localStorage.setItem(STORAGE_KEY.OUTBOUND, JSON.stringify(outboundRecords));
                updateUI();
            }

            // 导出数据
            function exportData() {
                const data = {
                    items,
                    inboundRecords,
                    outboundRecords
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'temple_inventory_' + new Date().toISOString().slice(0,10) + '.json';
                a.click();
            }

            // 导入数据
            function importData() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (
                                importedData.items &&
                                importedData.inboundRecords &&
                                importedData.outboundRecords
                            ) {
                                items = importedData.items;
                                inboundRecords = importedData.inboundRecords;
                                outboundRecords = importedData.outboundRecords;
                                localStorage.setItem(STORAGE_KEY.ITEMS, JSON.stringify(items));
                                localStorage.setItem(STORAGE_KEY.INBOUND, JSON.stringify(inboundRecords));
                                localStorage.setItem(STORAGE_KEY.OUTBOUND, JSON.stringify(outboundRecords));
                                updateUI();
                                alert('数据导入成功');
                            } else {
                                alert('无效的数据格式');
                            }
                        } catch (error) {
                            alert('数据解析失败');
                        }
                    };
                    reader.readAsText(file);
                };
                fileInput.click();
            }

            // 初始化界面
            updateUI();
        </script>
    </div>
</body>
</html>
