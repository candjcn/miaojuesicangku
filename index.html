<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯ºåº™ä»“åº“ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root { --primary: #4CAF50; --warning: #ff9800; --danger: #f44336; }
        * { box-sizing: border-box; font-family: Arial, sans-serif; }
        body { margin: 0; padding: 10px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .tabs { display: flex; margin-bottom: 10px; }
        .tab { flex:1; padding:10px; text-align:center; background:#ddd; border:none; cursor:pointer; }
        .tab.active { background:var(--primary); color:white; }
        .card { background:white; padding:15px; margin-bottom:10px; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom:10px; }
        input, select, button { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; }
        button { background:var(--primary); color:white; border:none; margin:2px; }
        button.warning { background:var(--warning); }
        button.danger { background:var(--danger); }
        .table { width:100%; border-collapse:collapse; }
        .table td, .table th { padding:8px; border-bottom:1px solid #ddd; text-align:left; }
        .alert { background:#ffeb3b; padding:10px; margin:10px 0; border-radius:4px; }
        @media (min-width: 600px) { .cols { display:flex; gap:10px; } .cols > * { flex:1; } }
    </style>
</head>
<body>
<div class="container">
    <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š ä»ªè¡¨ç›˜</button>
        <button class="tab" onclick="showTab('items')">ğŸ“¦ ç‰©å“</button>
        <button class="tab" onclick="showTab('in')">â¬‡ï¸ å…¥åº“</button>
        <button class="tab" onclick="showTab('out')">â¬†ï¸ å‡ºåº“</button>
        <button class="tab" onclick="showTab('reports')">ğŸ“ˆ æŠ¥è¡¨</button>
    </div>

    <!-- ä»ªè¡¨ç›˜ -->
    <div id="dashboard" class="tab-content">
        <div class="cols">
            <div class="card">
                <h3>ä»“åº“æ¦‚è§ˆ</h3>
                <p>æ€»ç‰©å“æ•°: <span id="totalItems">0</span></p>
                <p>åº“å­˜æ€»é‡: <span id="totalStock">0</span></p>
                <p>é¢„è­¦ç‰©å“: <span id="warningItems">0</span></p>
            </div>
            <div class="card">
                <h3>åº“å­˜é¢„è­¦</h3>
                <div id="alertsList"></div>
            </div>
        </div>
        <div class="card">
            <h3>æœ€è¿‘æ´»åŠ¨</h3>
            <div id="recentActivities"></div>
        </div>
    </div>

    <!-- ç‰©å“ç®¡ç† -->
    <div id="items" class="tab-content" style="display:none">
        <div class="card">
            <h3>ç‰©å“ç®¡ç†</h3>
            <form id="itemForm" onsubmit="return saveItem(event)">
                <input type="hidden" id="itemId">
                <div class="form-group"><input type="text" id="itemName" placeholder="ç‰©å“åç§°" required></div>
                <div class="cols">
                    <div class="form-group">
                        <select id="itemCategory" required>
                            <option value="">åˆ†ç±»</option>
                            <option value="ä½›å…·">ä½›å…·</option>
                            <option value="æ³•ç‰©">æ³•ç‰©</option>
                            <option value="æ—¥ç”¨å“">æ—¥ç”¨å“</option>
                        </select>
                    </div>
                    <div class="form-group"><input type="text" id="itemSpec" placeholder="è§„æ ¼"></div>
                    <div class="form-group"><input type="text" id="itemUnit" placeholder="å•ä½" required></div>
                </div>
                <div class="form-group"><input type="number" id="itemMinStock" placeholder="æœ€ä½åº“å­˜" required></div>
                <button type="submit">ğŸ’¾ ä¿å­˜</button>
            </form>
        </div>
        <div class="card">
            <h3>ç‰©å“åˆ—è¡¨ <button onclick="exportData()" class="warning">ğŸ“¤ å¯¼å‡ºæ•°æ®</button></h3>
            <div id="itemList"></div>
        </div>
    </div>

    <!-- å…¥åº“ç®¡ç† -->
    <div id="in" class="tab-content" style="display:none">
        <div class="card">
            <h3>ç‰©å“å…¥åº“</h3>
            <form onsubmit="return stockIn(event)">
                <div class="form-group">
                    <select id="inItem" required>
                        <option value="">é€‰æ‹©ç‰©å“</option>
                        ${loadItemOptions()}
                    </select>
                </div>
                <div class="cols">
                    <div class="form-group"><input type="number" id="inQty" placeholder="æ•°é‡" required></div>
                    <div class="form-group"><input type="text" id="inOperator" placeholder="æ“ä½œäºº" required></div>
                </div>
                <div class="form-group"><input type="date" id="inDate" required></div>
                <button type="submit">âœ… ç¡®è®¤å…¥åº“</button>
            </form>
        </div>
        <div class="card">
            <h3>å…¥åº“è®°å½•</h3>
            <div id="inRecords"></div>
        </div>
    </div>

    <!-- å‡ºåº“ç®¡ç† -->
    <div id="out" class="tab-content" style="display:none">
        <div class="card">
            <h3>ç‰©å“å‡ºåº“</h3>
            <form onsubmit="return stockOut(event)">
                <div class="form-group">
                    <select id="outItem" required>
                        <option value="">é€‰æ‹©ç‰©å“</option>
                        ${loadItemOptions()}
                    </select>
                </div>
                <div class="cols">
                    <div class="form-group"><input type="number" id="outQty" placeholder="æ•°é‡" required></div>
                    <div class="form-group"><input type="text" id="outOperator" placeholder="æ“ä½œäºº" required></div>
                </div>
                <div class="form-group"><input type="date" id="outDate" required></div>
                <button type="submit">âœ… ç¡®è®¤å‡ºåº“</button>
            </form>
        </div>
        <div class="card">
            <h3>å‡ºåº“è®°å½•</h3>
            <div id="outRecords"></div>
        </div>
    </div>

    <!-- ç»Ÿè®¡æŠ¥è¡¨ -->
    <div id="reports" class="tab-content" style="display:none">
        <div class="card">
            <h3>åº“å­˜ç»Ÿè®¡ <select id="reportType" onchange="generateReport()">
                <option value="month">æœˆåº¦æŠ¥è¡¨</option>
                <option value="year">å¹´åº¦æŠ¥è¡¨</option>
            </select></h3>
            <div id="reportResult"></div>
        </div>
        <div class="card">
            <h3>æ•°æ®ç®¡ç†</h3>
            <button onclick="exportData()" class="warning">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
            <button onclick="importData()" class="primary">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            <input type="file" id="fileInput" style="display:none">
        </div>
    </div>
</div>

<script>
// æ•°æ®å­˜å‚¨
let db = {
    items: JSON.parse(localStorage.getItem('items') || '[]'),
    inRecords: JSON.parse(localStorage.getItem('inRecords') || '[]'),
    outRecords: JSON.parse(localStorage.getItem('outRecords') || '[]')
};

// é€šç”¨åŠŸèƒ½
function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
    document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
    document.getElementById(tabId).style.display = 'block';
    event.target.classList.add('active');
    if(tabId === 'dashboard') updateDashboard();
}

// ç‰©å“ç®¡ç†
function saveItem(e) {
    e.preventDefault();
    const item = {
        id: document.getElementById('itemId').value || Date.now().toString(),
        name: document.getElementById('itemName').value,
        category: document.getElementById('itemCategory').value,
        spec: document.getElementById('itemSpec').value,
        unit: document.getElementById('itemUnit').value,
        minStock: parseInt(document.getElementById('itemMinStock').value)
    };
    const index = db.items.findIndex(i => i.id === item.id);
    if (index > -1) db.items[index] = item;
    else db.items.push(item);
    saveData();
    document.getElementById('itemForm').reset();
    renderItems();
}

function renderItems() {
    let html = '<table class="table">';
    db.items.forEach(item => {
        const stock = getStock(item.id);
        html += `<tr ${stock < item.minStock ? 'style="background:#ffe082"' : ''}>
            <td>${item.name} (${item.category})</td>
            <td>${stock}${item.unit}</td>
            <td><button onclick="editItem('${item.id}')">âœï¸</button>
            <button class="danger" onclick="deleteItem('${item.id}')">ğŸ—‘ï¸</button></td>
        </tr>`;
    });
    document.getElementById('itemList').innerHTML = html + '</table>';
    updateDashboard();
}

function editItem(id) {
    const item = db.items.find(i => i.id === id);
    if(item) {
        document.getElementById('itemId').value = item.id;
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemCategory').value = item.category;
        document.getElementById('itemSpec').value = item.spec;
        document.getElementById('itemUnit').value = item.unit;
        document.getElementById('itemMinStock').value = item.minStock;
    }
}

function deleteItem(id) {
    if(confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
        db.items = db.items.filter(i => i.id !== id);
        saveData();
        renderItems();
    }
}

// å…¥åº“å‡ºåº“åŠŸèƒ½
function stockIn(e) {
    e.preventDefault();
    const record = {
        id: Date.now(),
        itemId: document.getElementById('inItem').value,
        qty: parseInt(document.getElementById('inQty').value),
        operator: document.getElementById('inOperator').value,
        date: document.getElementById('inDate').value || new Date().toISOString().slice(0,10)
    };
    db.inRecords.push(record);
    saveData();
    updateDashboard();
    e.target.reset();
}

function stockOut(e) {
    e.preventDefault();
    const itemId = document.getElementById('outItem').value;
    const qty = parseInt(document.getElementById('outQty').value);
    if(getStock(itemId) < qty) return alert('åº“å­˜ä¸è¶³ï¼');
    
    const record = {
        id: Date.now(),
        itemId: itemId,
        qty: qty,
        operator: document.getElementById('outOperator').value,
        date: document.getElementById('outDate').value || new Date().toISOString().slice(0,10)
    };
    db.outRecords.push(record);
    saveData();
    updateDashboard();
    e.target.reset();
}

// æ•°æ®ç»Ÿè®¡
function getStock(itemId) {
    const inQty = db.inRecords.filter(r => r.itemId === itemId).reduce((a,b) => a + b.qty, 0);
    const outQty = db.outRecords.filter(r => r.itemId === itemId).reduce((a,b) => a + b.qty, 0);
    return inQty - outQty;
}

function updateDashboard() {
    document.getElementById('totalItems').textContent = db.items.length;
    document.getElementById('totalStock').textContent = db.items.reduce((a,b) => a + getStock(b.id), 0);
    const warnings = db.items.filter(item => getStock(item.id) < item.minStock);
    document.getElementById('warningItems').textContent = warnings.length;
    
    let alertsHtml = warnings.map(item => 
        `${item.name} åº“å­˜ ${getStock(item.id)}${item.unit} (æœ€ä½ ${item.minStock})`).join('
');
    document.getElementById('alertsList').innerHTML = alertsHtml || 'æ— é¢„è­¦ç‰©å“';
    
    // æœ€è¿‘æ´»åŠ¨
    const activities = [...db.inRecords, ...db.outRecords]
        .sort((a,b) => b.id - a.id)
        .slice(0,10)
        .map(r => {
            const item = db.items.find(i => i.id === r.itemId);
            return `${r.date} ${r.qty}${item?.unit} ${item?.name} (${'qty' in r ? 'å‡ºåº“' : 'å…¥åº“'})`;
        });
    document.getElementById('recentActivities').innerHTML = activities.join('
') || 'æš‚æ— æ´»åŠ¨';
}

// æ•°æ®æŒä¹…åŒ–
function saveData() {
    localStorage.setItem('items', JSON.stringify(db.items));
    localStorage.setItem('inRecords', JSON.stringify(db.inRecords));
    localStorage.setItem('outRecords', JSON.stringify(db.outRecords));
}

// åˆå§‹åŒ–
function init() {
    document.getElementById('inDate').value = new Date().toISOString().slice(0,10);
    document.getElementById('outDate').value = new Date().toISOString().slice(0,10);
    renderItems();
    updateDashboard();
}
init();
</script>
</body>
</html>
